```toml
[advisory]
id = "CVE-2024-56327"
package = "age"
date = "2024-12-18"
url = "https://www.cve.org/CVERecord?id=CVE-2024-56327"
# keywords = ["example", "freeform", "keywords"]
categories = ["code-execution"]
aliases = ["https://github.com/advisories/GHSA-4fg7-vxc8-qx5w"]
# cvss = "CVSS:4.0/AV:N/AC:H/AT:N/PR:L/UI:N/VC:L/VI:H/VA:N/SC:H/SI:H/SA:H"


[versions]
patched = [">= 0.6.1, >= 0.7.2, >= 0.8.2, >= 0.9.3, >= 0.10.1, >= 0.11.1"]
affected = ["= 0.6.0, >= 0.7.0, < 0.7.2, >= 0.8.0, < 0.8.2, >= 0.9.0, < 0.9.3, = 0.10.0, = 0.11.0"]
```

# Description

A plugin name containing a path separator may allow an attacker to execute an arbitrary binary.

Such a plugin name can be provided to the `rage` CLI through an `attacker-controlled` recipient or identity string, or to the following `age` APIs when the `plugin` feature flag is enabled:

- [age::plugin::Identity::from_str](https://docs.rs/age/0.11.0/age/plugin/struct.Identity.html#impl-FromStr-for-Identity) (or equivalently [str::parse::<age::plugin::Identity>()](https://doc.rust-lang.org/stable/core/primitive.str.html#method.parse))
- [age::plugin::Identity::default_for_plugin](https://docs.rs/age/0.11.0/age/plugin/struct.Identity.html#method.default_for_plugin)
- [age::plugin::IdentityPluginV1::new](https://docs.rs/age/0.11.0/age/plugin/struct.IdentityPluginV1.html#method.new)
- [age::plugin::Recipient::from_str](https://docs.rs/age/0.11.0/age/plugin/struct.Recipient.html#impl-FromStr-for-Recipient) (or equivalently [str::parse::<age::plugin::Recipient>()](https://doc.rust-lang.org/stable/core/primitive.str.html#method.parse))
- [age::plugin::RecipientPluginV1::new](https://docs.rs/age/0.11.0/age/plugin/struct.RecipientPluginV1.html#method.new)

On UNIX systems, a directory matching `age-plugin-*` needs to exist in the working directory for the attack to succeed.

The binary is executed with a single flag, either `--age-plugin=recipient-v1` or `--age-plugin=identity-v1`. The standard input includes the recipient or identity string, and the random file key (if encrypting) or the header of the file (if decrypting). The format is constrained by the [age-plugin](https://c2sp.org/age-plugin) protocol.

An equivalent issue was fixed in [the reference Go implementation of age](https://github.com/FiloSottile/age), see advisory [GHSA-32gq-x56h-299c](https://github.com/FiloSottile/age/security/advisories/GHSA-32gq-x56h-299c).

Thanks to â¬¡-49016 for reporting this issue.

## summary

pyrage is a set of Python bindings for the rage file encryption library (age in Rust). `pyrage` uses the Rust `age` crate for its underlying operations, and `age` is vulnerable to GHSA-4fg7-vxc8-qx5w. All details of GHSA-4fg7-vxc8-qx5w are relevant to `pyrage` for the versions specified in this advisory. See GHSA-4fg7-vxc8-qx5w for full details. Versions of `pyrage` before 1.2.0 lack plugin support and are therefore **not affected**. An equivalent issue was fixed in [the reference Go implementation of age](https://github.com/FiloSottile/age), see advisory GHSA-32gq-x56h-299c. This issue has been addressed in version 1.2.3 and all users are advised to update. There are no known workarounds for this vulnerability.",

## References

- [GHSA-4fg7-vxc8-qx5w](https://github.com/str4d/rage/security/advisories/GHSA-4fg7-vxc8-qx5w)
- [str4d/rage@703152e](https://github.com/str4d/rage/commit/703152ecfa86f27952a35b57dd525ed39396a227)
- [https://rustsec.org/advisories/RUSTSEC-2024-0432.html](https://rustsec.org/advisories/RUSTSEC-2024-0432.html)
- [https://rustsec.org/advisories/RUSTSEC-2024-0433.html](https://rustsec.org/advisories/RUSTSEC-2024-0433.html)