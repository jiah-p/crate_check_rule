```toml
[advisory]
id = "CVE-2024-43410"
package = "russh"
aliases = ["GHSA-vgvv-x7xg-6cqg"]
cvss = "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H"
date = "2024-08-15"
url = "https://nvd.nist.gov/vuln/detail/CVE-2024-43410"
categories = ["denial-of-service","memory-corruption"]

[versions]
patched = [">= 0.44.1"]
affected = ["<= 0.44.0"]
```

# OOM Denial of Service due to allocation of untrusted amount

## Summary

Allocating an untrusted amount of memory allows any unauthenticated user to OOM a russh server.

## Details

An `SSH packet` consists of a 4-byte big-endian length, followed by a byte stream of this length.
After parsing and potentially decrypting the 4-byte length, russh allocates enough memory for this bytestream, as a performance optimization to avoid reallocations later.

`russh/russh/src/cipher/mod.rs`
Line 254 in 4eaa080

 buffer.buffer.resize(buffer.len + 4); 

But this length is entirely untrusted and can be set to any value by the client, causing this much memory to be allocated, which will cause the process to `OOM` within a few such requests.

`RFC 4253` contains an explicit section on packet length limits: https://datatracker.ietf.org/doc/html/rfc4253#section-6.1

However, implementations SHOULD check that the packet length is reasonable in order for the implementation to avoid denial of service and/or buffer overflow attacks.

## PoC

Running the echoserver example on port 2222 (cd russh && cargo run --release --example echoserver), the provided Rust program can be executed against this echoserver and will cause it to OOM within a few tries.

## Impact

Due to this allocation, a russh server can be brought to OOM, causing a DoS.
Since this happens before authentication, it can be done by any user that has access to the TCP port over the internet.