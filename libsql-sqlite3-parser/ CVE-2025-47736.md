```toml
[advisory]
id = "CVE-2025-47736"
package = "libsql-sqlite3-parser"
date = "2025-05-09"
url = "https://www.cve.org/CVERecord?id=CVE-2025-47736"
categories = ["code-execution", "memory-corruption", "crypto-failure"]
keywords = ["segfault", "undefined behaviour"]
informational = "unsound"

[versions]
patched = ["> 0.13.0"]
affected = ["<= 0.13.0"]
```



# Description

dialect/mod.rs in the `libsql-sqlite3-parser` crate through 0.13.0 before 14f422a for Rust can crash if the input is not valid UTF-8.

## Details

a potential unsound issue in the utf-8 parsing, where it doesn't provide enough check to ensure the soundness.

libsql/vendored/sqlite3-parser/src/dialect/mod.rs

Lines 60 to 62 in 8145962
```rs
 fn from_bytes(bytes: &[u8]) -> String { 
     unsafe { str::from_utf8_unchecked(bytes).to_owned() } 
 } 
```

A potentail PoC code is like:
```rs
use libsql_sqlite3_parser::lexer::sql::{Parser, Tokenizer};
use fallible_iterator::FallibleIterator;


fn main() {
    let invalid_utf8: &[u8] = &[0xC0, 0x80]; 
    let sql = "SELECT ? ";
    let mut v = Vec::new();
    v.extend_from_slice(sql.as_bytes());
    v.extend_from_slice(invalid_utf8);
    let mut parser = Parser::new(&*v);
    let mut cmd = parser.next().unwrap();
    println!("{:?}", cmd)
}
```

## References

- [https://crates.io/crates/libsql-sqlite3-parser](https://crates.io/crates/libsql-sqlite3-parser)
- [https://github.com/gwenn/lemon-rs/issues/86](https://github.com/gwenn/lemon-rs/issues/86)
- [https://github.com/gwenn/lemon-rs/pull/8](https://github.com/gwenn/lemon-rs/pull/8)
- [https://github.com/tursodatabase/libsql/issues/2052](https://github.com/tursodatabase/libsql/issues/2052)
- [https://github.com/gwenn/lemon-rs/issues/86](https://github.com/gwenn/lemon-rs/issues/86)
